const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-BD-e9Xyp.js","assets/index-CwfwMfXG.js","assets/index-Bz1Lzr-B.css","assets/_commonjs-dynamic-modules-BHR_E30J.js","assets/sea-Bs9Yt_gB.js"])))=>i.map(i=>d[i]);
import{d as e,h as a,H as l,j as n,i as t,k as o,I as s,c as r,o as u,a as c,n as d,t as i,u as v,y as g,z as b,F as m,g as p,e as y,G as h,_ as x}from"./index-CwfwMfXG.js";const f={class:"tic-tac-toe-game"},w={class:"mb-4"},k={class:"flex items-center gap-2 mb-2"},_={class:"text-xs font-bold"},I={class:"mb-2"},X={class:"text-xs font-bold block mb-1"},E={class:"flex gap-1"},O=["placeholder"],S=["disabled"],T={class:"mb-2"},C={class:"text-xs font-bold block mb-1"},D={class:"flex gap-1"},P=["placeholder","disabled"],j=["disabled"],F={class:"game-board mb-4"},A={class:"grid grid-cols-3 gap-1 w-48 h-48 mx-auto border-2 border-dashed border-border p-2"},G=["onClick"],V={class:"text-center"},z={class:"mb-2"},K={class:"text-sm font-bold"},J={key:0,class:"mb-2"},L={class:"text-center"},N={class:"text-xs text-gray-500 mt-1"},R={key:1,class:"mb-2"},U=["disabled"],W=x(e({__name:"TicTacToeGame",setup(e){const{t:x}=a(),W=l(Array(9).fill("")),$=n("X"),H=n("waiting"),M=n(null),q=n("X"),B=n("disconnected"),Q=n(120),Y=n(null),Z=t(()=>$.value===q.value),ee=n(""),ae=n(""),le=n(null),ne=n(null),te=n(null),oe=n(""),se=async()=>{if(ae.value&&le.value){B.value="connecting";try{const e=[ee.value,ae.value].sort();oe.value=`game_${e[0].slice(-8)}_${e[1].slice(-8)}`,q.value=ee.value<ae.value?"X":"O",te.value=ne.value.get(oe.value),te.value.on(e=>{if(e){const a=Z.value;if(e.board){const a=JSON.parse(e.board);for(let e=0;e<9;e++)W[e]=a[e]}e.currentPlayer&&($.value=e.currentPlayer),e.gameStatus&&(H.value=e.gameStatus),e.winner&&(M.value=e.winner),"playing"===H.value&&a!==Z.value&&ce(),"playing"!==H.value&&de()}}),B.value="connected",H.value="playing","X"===q.value&&(await re(),ce())}catch(e){console.error("Failed to connect:",e),B.value="disconnected"}}},re=async()=>{if(te.value)try{await te.value.put({board:JSON.stringify(W),currentPlayer:$.value,gameStatus:H.value,winner:M.value,timestamp:Date.now()})}catch(e){console.error("Failed to update game state:",e)}},ue=e=>"connected"===B.value&&"playing"===H.value&&""===W[e]&&$.value===q.value,ce=()=>{de(),Q.value=120,Y.value=setInterval(()=>{Q.value--,Q.value<=0&&ie()},1e3)},de=()=>{Y.value&&(clearInterval(Y.value),Y.value=null)},ie=async()=>{"playing"===H.value&&(de(),$.value="X"===$.value?"O":"X",await re(),ce())},ve=()=>{const e=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const l of e){const[e,a,n]=l;if(W[e]&&W[e]===W[a]&&W[e]===W[n])return{isEnd:!0,isDraw:!1,winner:W[e]}}const a=W.every(e=>""!==e);return{isEnd:a,isDraw:a,winner:null}},ge=async()=>{"connected"===B.value&&(de(),W.fill(""),$.value="X",H.value="playing",M.value=null,await re(),ce())};return o(()=>{(async()=>{try{const e=(await h(async()=>{const{default:e}=await import("./browser-BD-e9Xyp.js").then(e=>e.b);return{default:e}},__vite__mapDeps([0,1,2,3]))).default;await h(()=>import("./sea-Bs9Yt_gB.js").then(e=>e.s),__vite__mapDeps([4,1,2,3])),ne.value=e(["https://a.talkflow.team/gun","https://gun.defucc.me/gun","https://gun-manhattan.herokuapp.com/gun","https://peer.wallie.io/gun","https://relay.peer.ooo/gun"]),le.value=await e.SEA.pair(),ee.value=le.value.pub,console.log("Gun initialized, public key:",ee.value)}catch(e){console.error("Failed to initialize Gun:",e)}})()}),s(()=>{de(),te.value&&te.value.off()}),(e,a)=>(u(),r("div",f,[c("div",w,[c("div",k,[c("div",{class:d(["w-3 h-3 rounded-full","connected"===B.value?"bg-green-500":"connecting"===B.value?"bg-yellow-500":"bg-red-500"])},null,2),c("span",_,i("connected"===B.value?v(x)("mesh.game.connection.connected"):"connecting"===B.value?v(x)("mesh.game.connection.connecting"):v(x)("mesh.game.connection.disconnected")),1)]),c("div",I,[c("label",X,i(v(x)("mesh.game.keys.yourKey"))+":",1),c("div",E,[g(c("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>ee.value=e),readonly:"",class:"flex-1 px-2 py-1 text-xs border border-dashed border-border bg-bg-secondary font-mono",placeholder:v(x)("mesh.game.keys.generating")},null,8,O),[[b,ee.value]]),c("button",{onClick:a[1]||(a[1]=e=>(async e=>{try{await navigator.clipboard.writeText(e),console.log("Copied to clipboard")}catch(a){console.error("Failed to copy:",a)}})(ee.value)),class:"px-2 py-1 text-xs border border-dashed border-border hover:bg-bg-secondary",disabled:!ee.value},i(v(x)("mesh.game.keys.copy")),9,S)])]),c("div",T,[c("label",C,i(v(x)("mesh.game.keys.opponentKey"))+":",1),c("div",D,[g(c("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>ae.value=e),class:"flex-1 px-2 py-1 text-xs border border-dashed border-border bg-bg-secondary font-mono",placeholder:v(x)("mesh.game.keys.enterOpponentKey"),disabled:"connected"===B.value},null,8,P),[[b,ae.value]]),c("button",{onClick:se,class:"px-2 py-1 text-xs border border-dashed border-border hover:bg-bg-secondary",disabled:!ae.value||"connected"===B.value},i(v(x)("mesh.game.controls.connect")),9,j)])])]),c("div",F,[c("div",A,[(u(!0),r(m,null,p(W,(e,a)=>(u(),r("div",{key:a,onClick:e=>(async e=>{if(!ue(e))return;de(),W[e]=q.value;const a=ve();a.isEnd?(H.value=a.isDraw?"draw":"win",M.value=a.winner):$.value="X"===$.value?"O":"X",await re(),"playing"===H.value&&ce()})(a),class:d(["border border-dashed border-border flex items-center justify-center text-2xl font-bold cursor-pointer hover:bg-bg-secondary transition-colors",{"cursor-not-allowed opacity-50":!ue(a),"bg-bg-secondary":""!==e}])},i(e),11,G))),128))])]),c("div",V,[c("div",z,[c("span",K,i(v(x)("mesh.game.gameInfo.currentPlayer"))+": "+i($.value===q.value?v(x)("mesh.game.gameInfo.you"):v(x)("mesh.game.gameInfo.opponent"))+" ("+i($.value)+") ",1)]),"playing"===H.value?(u(),r("div",J,[c("div",L,[c("span",{class:d(["text-lg font-bold",{"text-red-600":Q.value<=30,"text-yellow-600":Q.value<=60&&Q.value>30,"text-green-600":Q.value>60}])},i(Math.floor(Q.value/60))+":"+i(String(Q.value%60).padStart(2,"0")),3),c("div",N,i(Z.value?v(x)("mesh.game.timer.yourTurn"):v(x)("mesh.game.timer.opponentTurn")),1)])])):y("",!0),"playing"!==H.value?(u(),r("div",R,[c("span",{class:d(["text-sm font-bold",{"text-green-600":"win"===H.value&&M.value===q.value,"text-red-600":"win"===H.value&&M.value!==q.value,"text-gray-600":"draw"===H.value}])},i("win"===H.value?M.value===q.value?v(x)("mesh.game.gameInfo.youWin"):v(x)("mesh.game.gameInfo.opponentWin"):v(x)("mesh.game.gameInfo.draw")),3)])):y("",!0),c("button",{onClick:ge,class:"px-3 py-1 text-xs border border-dashed border-border hover:bg-bg-secondary",disabled:"connected"!==B.value},i(v(x)("mesh.game.controls.reset")),9,U)])]))}}),[["__scopeId","data-v-ea1af6eb"]]);export{W as default};
