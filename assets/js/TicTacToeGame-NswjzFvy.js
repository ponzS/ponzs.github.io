import{s as e,d as a,r as l,c as s,C as t,D as n,l as r,q as o,p as u,u as c,B as d,A as i,v,U as m,V as g,i as b,F as p,z as y,W as x}from"./vue-BFlYoKLU.js";import{a as h,u as f,_ as w}from"./index-D8-l0e88.js";import{G as k}from"./gun-2f3uxVze.js";import"./vendor-BVGoMDL0.js";const j={class:"tic-tac-toe-game"},C={class:"mb-4"},T={class:"flex items-center gap-2 mb-2"},I={class:"text-xs font-bold"},X={class:"mb-2"},S={class:"text-xs font-bold block mb-1"},R={class:"flex gap-1"},_=["placeholder"],O=["disabled"],P={class:"mb-2"},z={class:"text-xs font-bold block mb-1"},D={class:"flex gap-1"},K=["placeholder","disabled"],A=["disabled"],E={class:"game-board mb-4"},U={class:"grid grid-cols-3 gap-1 w-48 h-48 mx-auto border-2 border-dashed border-border p-2"},V=["onClick"],W={key:0,class:"mb-4 p-2 border border-dashed border-border bg-bg-secondary"},G={class:"text-xs font-bold mb-2 text-center"},J={class:"flex justify-center gap-4"},N={class:"flex items-center gap-1"},$=["data"],q={class:"text-xs"},B={class:"flex items-center gap-1"},F=["data"],L={class:"text-xs"},M={class:"text-center"},H={class:"mb-2 flex items-center justify-center gap-2"},Q={key:0,class:"flex items-center gap-1"},Y=["data"],Z={class:"text-sm font-bold"},ee={key:0,class:"mb-2"},ae={class:"text-center"},le={class:"text-xs text-gray-500 mt-1"},se={key:1,class:"mb-2"},te={class:"flex justify-center gap-2"},ne=["disabled"],re={class:"flex justify-between items-center mb-4"},oe={class:"text-lg font-bold"},ue={class:"space-y-6"},ce={class:"text-md font-bold mb-2"},de={class:"text-sm space-y-1"},ie={class:"text-md font-bold mb-2"},ve={class:"text-sm space-y-1"},me={class:"text-md font-bold mb-2"},ge={class:"text-sm space-y-1"},be={class:"mt-6 text-center"},pe=w(e({__name:"TicTacToeGame",setup(e){const{t:w}=h(),{myKeyPair:pe,myPublicKey:ye,getGameRef:xe}=f(),he=a(Array(9).fill("")),fe=l("X"),we=l("waiting"),ke=l(null),je=l("X"),Ce=l("disconnected"),Te=l(120),Ie=l(null),Xe=s(()=>fe.value===je.value),Se=l(""),Re=l(null),_e=l(""),Oe=l(!1),Pe=l(""),ze=l(null),De=async()=>{if(Se.value&&pe.value){Ce.value="connecting";try{const e=[ye.value,Se.value].sort();_e.value=`game_${e[0].slice(-8)}_${e[1].slice(-8)}`,je.value=ye.value<Se.value?"X":"O",Re.value=xe(_e.value),Re.value.on(e=>{if(e){const a=Xe.value;if(e.board){const a=JSON.parse(e.board);for(let e=0;e<9;e++)he[e]=a[e]}e.currentPlayer&&(fe.value=e.currentPlayer),e.gameStatus&&(we.value=e.gameStatus),e.winner&&(ke.value=e.winner),"playing"===we.value&&a!==Xe.value&&Ee(),"playing"!==we.value&&Ue()}}),Ce.value="connected",we.value="playing","X"===je.value&&(await Ke(),Ee())}catch(e){Ce.value="disconnected"}}},Ke=async()=>{if(Re.value)try{await Re.value.put({board:JSON.stringify(he),currentPlayer:fe.value,gameStatus:we.value,winner:ke.value,timestamp:Date.now()})}catch(e){}},Ae=e=>"connected"===Ce.value&&"playing"===we.value&&""===he[e]&&fe.value===je.value,Ee=()=>{Ue(),Te.value=120,Ie.value=setInterval(()=>{Te.value--,Te.value<=0&&Ve()},1e3)},Ue=()=>{Ie.value&&(clearInterval(Ie.value),Ie.value=null)},Ve=async()=>{"playing"===we.value&&(Ue(),fe.value="X"===fe.value?"O":"X",await Ke(),Ee())},We=()=>{const e=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const l of e){const[e,a,s]=l;if(he[e]&&he[e]===he[a]&&he[e]===he[s])return{isEnd:!0,isDraw:!1,winner:he[e]}}const a=he.every(e=>""!==e);return{isEnd:a,isDraw:a,winner:null}},Ge=async()=>{"connected"===Ce.value&&(Ue(),he.fill(""),fe.value="X",we.value="playing",ke.value=null,await Ke(),Ee())};return t(()=>{}),n(()=>{Ue(),Re.value&&Re.value.off(),ze.value&&clearTimeout(ze.value)}),(e,a)=>(o(),r("div",j,[u("div",C,[u("div",T,[u("div",{class:d(["w-3 h-3 rounded-full","connected"===Ce.value?"bg-green-500":"connecting"===Ce.value?"bg-yellow-500":"bg-red-500"])},null,2),u("span",I,i("connected"===Ce.value?v(w)("mesh.game.connection.connected"):"connecting"===Ce.value?v(w)("mesh.game.connection.connecting"):v(w)("mesh.game.connection.disconnected")),1)]),u("div",X,[u("label",S,i(v(w)("mesh.game.keys.yourKey"))+":",1),u("div",R,[m(u("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>b(ye)?ye.value=e:null),readonly:"",class:"flex-1 px-2 py-1 text-xs border border-dashed border-border bg-bg-secondary font-mono",placeholder:v(w)("mesh.game.keys.generating")},null,8,_),[[g,v(ye)]]),u("button",{onClick:a[1]||(a[1]=e=>(async e=>{try{await navigator.clipboard.writeText(e),Pe.value=w("mesh.game.keys.copySuccess"),ze.value&&clearTimeout(ze.value),ze.value=setTimeout(()=>{Pe.value=""},2e3)}catch(a){Pe.value=w("mesh.game.keys.copyError"),ze.value&&clearTimeout(ze.value),ze.value=setTimeout(()=>{Pe.value=""},3e3)}})(v(ye))),class:"px-2 py-1 text-xs border border-dashed border-border hover:bg-bg-secondary relative",disabled:!v(ye)},i(v(w)("mesh.game.keys.copy")),9,O)]),Pe.value?(o(),r("div",{key:0,class:d(["mt-1 text-xs font-medium transition-all duration-300",{"text-green-600":Pe.value.includes("成功")||Pe.value.includes("success"),"text-red-600":Pe.value.includes("失败")||Pe.value.includes("error")}])},i(Pe.value),3)):c("",!0)]),u("div",P,[u("label",z,i(v(w)("mesh.game.keys.opponentKey"))+":",1),u("div",D,[m(u("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>Se.value=e),class:"flex-1 px-2 py-1 text-xs border border-dashed border-border bg-bg-secondary font-mono",placeholder:v(w)("mesh.game.keys.enterOpponentKey"),disabled:"connected"===Ce.value},null,8,K),[[g,Se.value]]),u("button",{onClick:De,class:"px-2 py-1 text-xs border border-dashed border-border hover:bg-bg-secondary",disabled:!Se.value||"connected"===Ce.value},i(v(w)("mesh.game.controls.connect")),9,A)])])]),u("div",E,[u("div",U,[(o(!0),r(p,null,y(he,(e,a)=>(o(),r("div",{key:a,onClick:e=>(async e=>{if(!Ae(e))return;Ue(),he[e]=je.value;const a=We();a.isEnd?(we.value=a.isDraw?"draw":"win",ke.value=a.winner):fe.value="X"===fe.value?"O":"X",await Ke(),"playing"===we.value&&Ee()})(a),class:d(["border border-dashed border-border flex items-center justify-center text-2xl font-bold cursor-pointer hover:bg-bg-secondary transition-colors",{"cursor-not-allowed opacity-50":!Ae(a),"bg-bg-secondary":""!==e}])},i(e),11,V))),128))])]),"connected"===Ce.value?(o(),r("div",W,[u("div",G,i(v(w)("mesh.game.avatars.avatarLegend")),1),u("div",J,[u("div",N,[u("object",{class:"w-5 h-5",type:"image/svg+xml",data:v(k)({pub:v(ye),size:20,dark:!0,svg:!0})},null,8,$),u("span",q,i(v(w)("mesh.game.avatars.myAvatar")),1)]),u("div",B,[u("object",{class:"w-5 h-5",type:"image/svg+xml",data:v(k)({pub:Se.value,size:20,dark:!0,svg:!0})},null,8,F),u("span",L,i(v(w)("mesh.game.avatars.opponentAvatar")),1)])])])):c("",!0),u("div",M,[u("div",H,["connected"===Ce.value?(o(),r("div",Q,[u("object",{class:"w-6 h-6",type:"image/svg+xml",data:v(k)({pub:fe.value===je.value?v(ye):Se.value,size:24,dark:!0,svg:!0})},null,8,Y)])):c("",!0),u("span",Z,i(v(w)("mesh.game.gameInfo.currentPlayer"))+": "+i(fe.value===je.value?v(w)("mesh.game.gameInfo.you"):v(w)("mesh.game.gameInfo.opponent"))+" ("+i(fe.value)+") ",1)]),"playing"===we.value?(o(),r("div",ee,[u("div",ae,[u("span",{class:d(["text-lg font-bold",{"text-red-600":Te.value<=30,"text-yellow-600":Te.value<=60&&Te.value>30,"text-green-600":Te.value>60}])},i(Math.floor(Te.value/60))+":"+i(String(Te.value%60).padStart(2,"0")),3),u("div",le,i(Xe.value?v(w)("mesh.game.timer.yourTurn"):v(w)("mesh.game.timer.opponentTurn")),1)])])):c("",!0),"playing"!==we.value?(o(),r("div",se,[u("span",{class:d(["text-sm font-bold",{"text-green-600":"win"===we.value&&ke.value===je.value,"text-red-600":"win"===we.value&&ke.value!==je.value,"text-gray-600":"draw"===we.value}])},i("win"===we.value?ke.value===je.value?v(w)("mesh.game.gameInfo.youWin"):v(w)("mesh.game.gameInfo.opponentWin"):v(w)("mesh.game.gameInfo.draw")),3)])):c("",!0),u("div",te,[u("button",{onClick:Ge,class:"px-3 py-1 text-xs border border-dashed border-border hover:bg-bg-secondary",disabled:"connected"!==Ce.value},i(v(w)("mesh.game.controls.reset")),9,ne),u("button",{onClick:a[3]||(a[3]=e=>Oe.value=!0),class:"px-3 py-1 text-xs border border-dashed border-border hover:bg-bg-secondary"},i(v(w)("mesh.game.rules.button")),1)])]),Oe.value?(o(),r("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:a[7]||(a[7]=e=>Oe.value=!1)},[u("div",{class:"bg-bg-primary border-2 border-dashed border-border p-6 max-w-2xl max-h-[80vh] overflow-y-auto",onClick:a[6]||(a[6]=x(()=>{},["stop"]))},[u("div",re,[u("h2",oe,i(v(w)("mesh.game.rules.title")),1),u("button",{onClick:a[4]||(a[4]=e=>Oe.value=!1),class:"text-xl hover:bg-bg-secondary px-2 py-1 border border-dashed border-border"},"×")]),u("div",ue,[u("div",null,[u("h3",ce,i(v(w)("mesh.game.rules.gameRules.title")),1),u("div",de,[u("p",null,i(v(w)("mesh.game.rules.gameRules.rule1")),1),u("p",null,i(v(w)("mesh.game.rules.gameRules.rule2")),1),u("p",null,i(v(w)("mesh.game.rules.gameRules.rule3")),1),u("p",null,i(v(w)("mesh.game.rules.gameRules.rule4")),1),u("p",null,i(v(w)("mesh.game.rules.gameRules.rule5")),1)])]),u("div",null,[u("h3",ie,i(v(w)("mesh.game.rules.connection.title")),1),u("div",ve,[u("p",null,i(v(w)("mesh.game.rules.connection.step1")),1),u("p",null,i(v(w)("mesh.game.rules.connection.step2")),1),u("p",null,i(v(w)("mesh.game.rules.connection.step3")),1),u("p",null,i(v(w)("mesh.game.rules.connection.step4")),1),u("p",null,i(v(w)("mesh.game.rules.connection.step5")),1)])]),u("div",null,[u("h3",me,i(v(w)("mesh.game.rules.technology.title")),1),u("div",ge,[u("p",null,i(v(w)("mesh.game.rules.technology.desc1")),1),u("p",null,i(v(w)("mesh.game.rules.technology.desc2")),1),u("p",null,i(v(w)("mesh.game.rules.technology.desc3")),1),u("p",null,i(v(w)("mesh.game.rules.technology.desc4")),1),u("p",null,i(v(w)("mesh.game.rules.technology.desc5")),1)])])]),u("div",be,[u("button",{onClick:a[5]||(a[5]=e=>Oe.value=!1),class:"px-4 py-2 text-sm border border-dashed border-border hover:bg-bg-secondary"},i(v(w)("mesh.game.rules.close")),1)])])])):c("",!0)]))}}),[["__scopeId","data-v-863639b2"]]);export{pe as default};
