import{d as e}from"./vendor-7a5jsvqZ.js";import{r as t,c as a}from"./vue-D_SvuEeF.js";const o=e("blog",()=>{const e=t(null),o=t(null),r=t(new Map),n=t(!1),l=t(null),s=t(null),u=t(""),i=t(null),c=t(null),g=a(()=>o.value?.posts||[]),f=a(()=>o.value?.categories||[]),v=a(()=>o.value?.tags||[]),d=a(()=>g.value.filter(e=>e.featured)),w=a(()=>[...g.value].sort((e,t)=>new Date(t.publishDate).getTime()-new Date(e.publishDate).getTime()).slice(0,6)),h=a(()=>{let e=g.value;if(i.value&&(e=e.filter(e=>e.category.toLowerCase()===i.value?.toLowerCase()||f.value.find(e=>e.id===i.value)?.name===e.category)),c.value&&(e=e.filter(e=>e.tags.some(e=>e.toLowerCase()===c.value?.toLowerCase()))),u.value.trim()){const t=u.value.toLowerCase();e=e.filter(e=>e.title.toLowerCase().includes(t)||e.excerpt.toLowerCase().includes(t)||e.tags.some(e=>e.toLowerCase().includes(t)))}return e}),m=a(()=>s.value?g.value.filter(e=>e.id!==s.value.id&&(e.category===s.value.category||e.tags.some(e=>s.value.tags.includes(e)))).slice(0,3):[]);let y=null;async function C(e="zh",t=3,a=1e3){if(o.value&&!n.value)return;y&&clearTimeout(y),n.value=!0,l.value=null;const r=async n=>{try{const t="en"===e?"/data/blog-list-en.json":"/data/blog-list-zh.json",a=new AbortController,r=setTimeout(()=>a.abort(),1e4),n=await fetch(t,{signal:a.signal,cache:"no-cache",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(clearTimeout(r),!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.json();if(!s||!Array.isArray(s.posts))throw new Error("Invalid data structure received");o.value=s,l.value=null}catch(s){if(n<t){const e=a*Math.pow(2,n-1);return await new Promise(t=>{y=setTimeout(t,e)}),r(n+1)}{const e=s instanceof Error?s.message:"Failed to load blog list data";throw l.value=`${e} (after ${t} attempts)`,s}}};try{await r(1)}catch(s){}finally{n.value=!1,y&&(clearTimeout(y),y=null)}}async function L(e){if(r.value.has(e))return r.value.get(e);try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return r.value.set(e,a),a}catch(t){return null}}function P(e){return g.value.find(t=>t.slug===e)}async function T(e){const t=P(e);return t?await L(t.contentPath):null}function p(e){s.value=e}return{blogData:e,blogListData:o,postContentCache:r,loading:n,error:l,currentPost:s,searchQuery:u,selectedCategory:i,selectedTag:c,posts:g,categories:f,tags:v,featuredPosts:d,latestPosts:w,filteredPosts:h,relatedPosts:m,loadBlogData:async function(e="zh"){await C(e)},loadBlogListData:C,refreshBlogListData:async function(e="zh",t=3,a=1e3){o.value=null,await C(e,t,a)},loadPostContent:L,getPostListItemBySlug:P,getPostBySlug:T,setCurrentPost:p,setCurrentPostBySlug:async function(e){p(await T(e))},setSearchQuery:function(e){u.value=e},setSelectedCategory:function(e){i.value=e},setSelectedTag:function(e){c.value=e},clearFilters:function(){u.value="",i.value=null,c.value=null},getPostsByCategory:function(e){return g.value.filter(t=>t.category.toLowerCase()===e.toLowerCase()||f.value.find(t=>t.id===e)?.name===t.category)},getPostsByTag:function(e){return g.value.filter(t=>t.tags.some(t=>t.toLowerCase()===e.toLowerCase()))},searchPosts:function(e){const t=e.toLowerCase();return g.value.filter(e=>e.title.toLowerCase().includes(t)||e.excerpt.toLowerCase().includes(t)||e.tags.some(e=>e.toLowerCase().includes(t)))},formatDate:function(e,t="zh"){const a=new Date(e);return"en"===t?a.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):a.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})},getReadTimeText:function(e,t="zh"){return"en"===t?`${e} min read`:`${e} 分钟阅读`}}});export{o as u};
