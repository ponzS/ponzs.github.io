import{K as t,J as e}from"./index-CwfwMfXG.js";import{c as r}from"./_commonjs-dynamic-modules-BHR_E30J.js";function n(t,e){for(var r=0;r<e.length;r++){const n=e[r];if("string"!=typeof n&&!Array.isArray(n))for(const e in n)if("default"!==e&&!(e in t)){const r=Object.getOwnPropertyDescriptor(n,e);r&&Object.defineProperty(t,e,r.get?r:{enumerable:!0,get:()=>n[e]})}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}var o,a={exports:{}};var i,s=(o||(o=1,i=a,function(){function e(t,n){return n?r(t):t.slice?e[o(t)]:function(r,n){t(r={exports:{}}),e[o(n)]=r.exports};function o(t){return t.split("/").slice(-1).toString().replace(".js","")}}var n=i;e(function(t){"undefined"!=typeof self&&(t.window=self),"undefined"!=typeof window&&(t.window=window);var e=(t.window||t).SEA||{};(e.window=t.window)&&(e.window.SEA=e);try{void 0+""!=typeof n&&(n.exports=e)}catch(r){}t.exports=e})(e,"./root"),e(function(t){var r=e("./root");try{r.window&&location.protocol.indexOf("s")<0&&location.host.indexOf("localhost")<0&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&location.protocol.indexOf("file:")<0&&(console.warn("HTTPS needed for WebCrypto in SEA, redirecting..."),location.protocol="https:")}catch(n){}})(e,"./https"),e(function(r){var n;if(n+""==typeof btoa){if(n+""==typeof Buffer)try{t.Buffer=e("buffer",1).Buffer}catch(o){console.log("Please `npm install buffer` or add it to your package.json !")}t.btoa=function(t){return Buffer.from(t,"binary").toString("base64")},t.atob=function(t){return Buffer.from(t,"base64").toString("binary")}}})(e,"./base64"),e(function(t){function r(){}e("./base64"),Object.assign(r,{from:Array.from}),r.prototype=Object.create(Array.prototype),r.prototype.toString=function(t,e,r){t=t||"utf8",e=e||0;const n=this.length;if("hex"===t){const t=new Uint8Array(this);return[...Array((r&&r+1||n)-e).keys()].map(r=>t[r+e].toString(16).padStart(2,"0")).join("")}return"utf8"===t?Array.from({length:(r||n)-e},(t,r)=>String.fromCharCode(this[r+e])).join(""):"base64"===t?btoa(this):void 0},t.exports=r})(e,"./array"),e(function(t){e("./base64");var r=e("./array");function n(...t){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),n.from(...t)}n.prototype=Object.create(Array.prototype),Object.assign(n,{from(){if(!Object.keys(arguments).length||null==arguments[0])throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");const t=arguments[0];let e;if("string"==typeof t){const n=arguments[1]||"utf8";if("hex"===n){const n=t.match(/([\da-fA-F]{2})/g).map(t=>parseInt(t,16));if(!n||!n.length)throw new TypeError("Invalid first argument for type 'hex'.");e=r.from(n)}else if("utf8"===n||"binary"===n){const n=t.length,o=new Uint16Array(n);Array.from({length:n},(e,r)=>o[r]=t.charCodeAt(r)),e=r.from(o)}else if("base64"===n){const n=atob(t),o=n.length,a=new Uint8Array(o);Array.from({length:o},(t,e)=>a[e]=n.charCodeAt(e)),e=r.from(a)}else"binary"===n?e=r.from(t):console.info("SafeBuffer.from unknown encoding: "+n);return e}if(t.byteLength,t.byteLength?t.byteLength:t.length){let e;return t instanceof ArrayBuffer&&(e=new Uint8Array(t)),r.from(e||t)}},alloc:(t,e=0)=>r.from(new Uint8Array(Array.from({length:t},()=>e))),allocUnsafe:t=>r.from(new Uint8Array(Array.from({length:t}))),concat(t){if(!Array.isArray(t))throw new TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return r.from(t.reduce((t,e)=>t.concat(Array.from(e)),[]))}}),n.prototype.from=n.from,n.prototype.toString=r.prototype.toString,t.exports=n})(e,"./buffer"),e(function(t){const r=e("./root"),o={Buffer:e("./buffer")};var a={};if(JSON.parseAsync=JSON.parseAsync||function(t,e,r){try{e(void 0,JSON.parse(t,r))}catch(n){e(n)}},JSON.stringifyAsync=JSON.stringifyAsync||function(t,e,r,n){try{e(void 0,JSON.stringify(t,r,n))}catch(o){e(o)}},o.parse=function(t,e){return new Promise(function(r,n){JSON.parseAsync(t,function(t,e){t?n(t):r(e)},e)})},o.stringify=function(t,e,r){return new Promise(function(n,o){JSON.stringifyAsync(t,function(t,e){t?o(t):n(e)},e,r)})},r.window&&(o.crypto=r.window.crypto||r.window.msCrypto,o.subtle=(o.crypto||a).subtle||(o.crypto||a).webkitSubtle,o.TextEncoder=r.window.TextEncoder,o.TextDecoder=r.window.TextDecoder,o.random=t=>o.Buffer.from(o.crypto.getRandomValues(new Uint8Array(o.Buffer.alloc(t))))),!o.TextDecoder){const{TextEncoder:t,TextDecoder:r}=e((void 0+""==typeof n?".":"")+"./lib/text-encoding",1);o.TextDecoder=r,o.TextEncoder=t}if(!o.crypto)try{var i=e("crypto",1);Object.assign(o,{crypto:i,random:t=>o.Buffer.from(i.randomBytes(t))});const{Crypto:t}=e("@peculiar/webcrypto",1);o.ossl=o.subtle=new t({directory:"ossl"}).subtle}catch(s){console.log("Please `npm install @peculiar/webcrypto` or add it to your package.json !")}t.exports=o})(e,"./shim"),e(function(t){var r=e("./root"),n=e("./shim"),o={pbkdf2:{hash:{name:"SHA-256"},iter:1e5,ks:64},ecdsa:{pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},ecdh:{name:"ECDH",namedCurve:"P-256"},jwk:function(t,e){var r={kty:"EC",crv:"P-256",x:(t=t.split("."))[0],y:t[1],ext:!0};return r.key_ops=e?["sign"]:["verify"],e&&(r.d=e),r},keyToJwk:function(t){return{kty:"oct",k:t.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),ext:!1,alg:"A256GCM"}},recall:{validity:43200,hook:function(t){return t}},check:function(t){return"string"==typeof t&&"SEA{"===t.slice(0,4)},parse:async function(t){try{var e="string"==typeof t;return e&&"SEA{"===t.slice(0,4)&&(t=t.slice(3)),e?await n.parse(t):t}catch(r){}return t}};r.opt=o,t.exports=o})(e,"./settings"),e(function(t){var r=e("./shim");t.exports=async function(t,e){var n="string"==typeof t?t:await r.stringify(t),o=await r.subtle.digest({name:e||"SHA-256"},(new r.TextEncoder).encode(n));return r.Buffer.from(o)}})(e,"./sha256"),e(function(t){const r=e("./shim"),n=r.subtle,o=r.ossl?r.ossl:n;t.exports=t=>o.digest({name:"SHA-1"},new ArrayBuffer(t))})(e,"./sha1"),e(function(t){var r=e("./root"),n=e("./shim"),o=e("./settings"),a=e("./sha256");r.work=r.work||(async(t,e,i,s)=>{try{var c=(e||{}).epub||e;if(s=s||{},c instanceof Function&&(i=c,c=void 0),t="string"==typeof t?t:await n.stringify(t),"sha"===(s.name||"").toLowerCase().slice(0,3)){var u=n.Buffer.from(await a(t,s.name),"binary").toString(s.encode||"base64");if(i)try{i(u)}catch(y){console.log(y)}return u}c=c||n.random(9);var f=await(n.ossl||n.subtle).importKey("raw",(new n.TextEncoder).encode(t),{name:s.name||"PBKDF2"},!1,["deriveBits"]),p=await(n.ossl||n.subtle).deriveBits({name:s.name||"PBKDF2",iterations:s.iterations||o.pbkdf2.iter,salt:(new n.TextEncoder).encode(s.salt||c),hash:s.hash||o.pbkdf2.hash},f,s.length||8*o.pbkdf2.ks);t=n.random(t.length);var l=n.Buffer.from(p,"binary").toString(s.encode||"base64");if(i)try{i(l)}catch(y){console.log(y)}return l}catch(y){if(console.log(y),r.err=y,r.throw)throw y;return void(i&&i())}}),t.exports=r.work})(e,"./work"),e(function(t){var r=e("./root"),n=e("./shim");e("./settings"),r.name=r.name||(async(t,e)=>{try{if(t)try{t()}catch(n){console.log(n)}return}catch(n){if(console.log(n),r.err=n,r.throw)throw n;return void(t&&t())}}),r.pair=r.pair||(async(t,e)=>{try{var o=n.ossl||n.subtle,a=await n.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async t=>{var e={};e.priv=(await n.subtle.exportKey("jwk",t.privateKey)).d;var r=await n.subtle.exportKey("jwk",t.publicKey);return e.pub=r.x+"."+r.y,e});try{var i=await o.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async t=>{var e={};e.epriv=(await o.exportKey("jwk",t.privateKey)).d;var r=await o.exportKey("jwk",t.publicKey);return e.epub=r.x+"."+r.y,e})}catch(c){if(r.window)throw c;if("Error: ECDH is not a supported algorithm"!=c)throw c;console.log("Ignoring ECDH...")}i=i||{};var s={pub:a.pub,priv:a.priv,epub:i.epub,epriv:i.epriv};if(t)try{t(s)}catch(c){console.log(c)}return s}catch(c){if(console.log(c),r.err=c,r.throw)throw c;return void(t&&t())}}),t.exports=r.pair})(e,"./pair"),e(function(t){var r,n=e("./root"),o=e("./shim"),a=e("./settings"),i=e("./sha256");n.sign=n.sign||(async(t,e,s,c)=>{try{if(c=c||{},!(e||c).priv){if(!n.I)throw"No signing key.";e=await n.I(null,{what:t,how:"sign",why:c.why})}if(r===t)throw"`undefined` not allowed.";var u=await a.parse(t),f=c.check=c.check||u;if(n.verify&&(n.opt.check(f)||f&&f.s&&f.m)&&r!==await n.verify(f,e)){var p=await a.parse(f);if(c.raw||(p="SEA"+await o.stringify(p)),s)try{s(p)}catch(d){console.log(d)}return p}var l=e.pub,y=e.priv,h=a.jwk(l,y),g=await i(u),w=await(o.ossl||o.subtle).importKey("jwk",h,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(t=>(o.ossl||o.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},t,new Uint8Array(g)));if(p={m:u,s:o.Buffer.from(w,"binary").toString(c.encode||"base64")},c.raw||(p="SEA"+await o.stringify(p)),s)try{s(p)}catch(d){console.log(d)}return p}catch(d){if(console.log(d),n.err=d,n.throw)throw d;return void(s&&s())}}),t.exports=n.sign})(e,"./sign"),e(function(t){var r,n=e("./root"),o=e("./shim"),a=e("./settings"),i=e("./sha256");n.verify=n.verify||(async(t,e,s,c)=>{try{var u=await a.parse(t);if(!1===e){var f=await a.parse(u.m);if(s)try{s(f)}catch(b){console.log(b)}return f}c=c||{};var p,l,y,h=e.pub||e,g=n.opt.slow_leak?await n.opt.slow_leak(h):await(o.ossl||o.subtle).importKey("jwk",a.jwk(h),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),w=await i(u.m);try{if(p=o.Buffer.from(u.s,c.encode||"base64"),l=new Uint8Array(p),!(y=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},g,l,new Uint8Array(w))))throw"Signature did not match."}catch(b){if(n.opt.fallback)return await n.opt.fall_verify(t,e,s,c)}var d=y?await a.parse(u.m):r;if(s)try{s(d)}catch(b){console.log(b)}return d}catch(b){if(console.log(b),n.err=b,n.throw)throw b;return void(s&&s())}}),t.exports=n.verify;var s={};n.opt.slow_leak=t=>{if(s[t])return s[t];var e=a.jwk(t);return s[t]=(o.ossl||o.subtle).importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),s[t]};var c=n.opt;n.opt.fall_verify=async function(t,e,s,u,f){if(f===n.opt.fallback)throw"Signature did not match";f=f||1;var p=t||"";t=n.opt.unpack(t)||t;var l,y,h,g=await a.parse(t),w=e.pub||e,d=await n.opt.slow_leak(w),b=f<=n.opt.fallback?o.Buffer.from(await o.subtle.digest({name:"SHA-256"},(new o.TextEncoder).encode(await a.parse(g.m)))):await i(g.m);try{if(l=o.Buffer.from(g.s,u.encode||"base64"),y=new Uint8Array(l),!(h=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},d,y,new Uint8Array(b))))throw"Signature did not match."}catch(m){try{l=o.Buffer.from(g.s,"utf8"),y=new Uint8Array(l),h=await(o.ossl||o.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},d,y,new Uint8Array(b))}catch(A){if(!h)throw"Signature did not match."}}var v=h?await a.parse(g.m):r;if(c.fall_soul=p["#"],c.fall_key=p["."],c.fall_val=t,c.fall_state=p[">"],s)try{s(v)}catch(m){console.log(m)}return v},n.opt.fallback=2})(e,"./verify"),e(function(t){var r=e("./shim"),n=e("./settings"),o=e("./sha256");t.exports=async(t,e,a)=>{const i=t+(e||r.random(8)).toString("utf8"),s=r.Buffer.from(await o(i),"binary"),c=n.keyToJwk(s);return await r.subtle.importKey("jwk",c,{name:"AES-GCM"},!1,["encrypt","decrypt"])}})(e,"./aeskey"),e(function(t){var r=e("./root"),n=e("./shim");e("./settings");var o=e("./aeskey");r.encrypt=r.encrypt||(async(t,e,a,i)=>{try{i=i||{};var s=(e||i).epriv||e;if(void 0===t)throw"`undefined` not allowed.";if(!s){if(!r.I)throw"No encryption key.";s=(e=await r.I(null,{what:t,how:"encrypt",why:i.why})).epriv||e}var c="string"==typeof t?t:await n.stringify(t),u={s:n.random(9),iv:n.random(15)},f=await o(s,u.s,i).then(t=>n.subtle.encrypt({name:i.name||"AES-GCM",iv:new Uint8Array(u.iv)},t,(new n.TextEncoder).encode(c))),p={ct:n.Buffer.from(f,"binary").toString(i.encode||"base64"),iv:u.iv.toString(i.encode||"base64"),s:u.s.toString(i.encode||"base64")};if(i.raw||(p="SEA"+await n.stringify(p)),a)try{a(p)}catch(l){console.log(l)}return p}catch(l){if(console.log(l),r.err=l,r.throw)throw l;return void(a&&a())}}),t.exports=r.encrypt})(e,"./encrypt"),e(function(t){var r=e("./root"),n=e("./shim"),o=e("./settings"),a=e("./aeskey");r.decrypt=r.decrypt||(async(t,e,i,s)=>{try{s=s||{};var c=(e||s).epriv||e;if(!c){if(!r.I)throw"No decryption key.";c=(e=await r.I(null,{what:t,how:"decrypt",why:s.why})).epriv||e}var u,f,p,l=await o.parse(t);try{u=n.Buffer.from(l.s,s.encode||"base64"),f=n.Buffer.from(l.iv,s.encode||"base64"),p=n.Buffer.from(l.ct,s.encode||"base64");var y=await a(c,u,s).then(t=>n.subtle.decrypt({name:s.name||"AES-GCM",iv:new Uint8Array(f),tagLength:128},t,new Uint8Array(p)))}catch(g){if("utf8"===s.encode)throw"Could not decrypt";if(r.opt.fallback)return s.encode="utf8",await r.decrypt(t,e,i,s)}var h=await o.parse(new n.TextDecoder("utf8").decode(y));if(i)try{i(h)}catch(g){console.log(g)}return h}catch(g){if(console.log(g),r.err=g,r.throw)throw g;return void(i&&i())}}),t.exports=r.decrypt})(e,"./decrypt"),e(function(t){var r=e("./root"),n=e("./shim");e("./settings"),r.secret=r.secret||(async(t,e,a,i)=>{try{if(i=i||{},!e||!e.epriv||!e.epub){if(!r.I)throw"No secret mix.";e=await r.I(null,{what:t,how:"secret",why:i.why})}var s=t.epub||t,c=e.epub,u=e.epriv,f=n.ossl||n.subtle,p=o(s),l=Object.assign({public:await f.importKey(...p,!0,[])},{name:"ECDH",namedCurve:"P-256"}),y=o(c,u),h=await f.importKey(...y,!1,["deriveBits"]).then(async t=>{var e=await f.deriveBits(l,t,256),r=new Uint8Array(e),n=await f.importKey("raw",r,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return f.exportKey("jwk",n).then(({k:t})=>t)});if(a)try{a(h)}catch(g){console.log(g)}return h}catch(g){if(console.log(g),r.err=g,r.throw)throw g;return void(a&&a())}});var o=(t,e)=>{var[r,n]=t.split("."),o=e?{d:e}:{};return["jwk",Object.assign(o,{x:r,y:n,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};t.exports=r.secret})(e,"./secret"),e(function(t){var r=e("./root");r.certify=r.certify||(async(t,e={},n,o,a={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),!(t=(()=>{var e=[];if(t){if(("string"==typeof t||Array.isArray(t))&&t.indexOf("*")>-1)return"*";if("string"==typeof t)return t;if(Array.isArray(t)){if(1===t.length&&t[0])return"object"==typeof t[0]&&t[0].pub?t[0].pub:"string"==typeof t[0]?t[0]:null;t.map(t=>{"string"==typeof t?e.push(t):"object"==typeof t&&t.pub&&e.push(t.pub)})}return"object"==typeof t&&t.pub?t.pub:e.length>0?e:null}})()))return console.log("No certificant found.");const c=!a.expiry||"number"!=typeof a.expiry&&"string"!=typeof a.expiry?null:parseFloat(a.expiry),u=(e||{}).read?e.read:null,f=(e||{}).write?e.write:"string"==typeof e||Array.isArray(e)||e["+"]||e["#"]||e["."]||e["="]||e["*"]||e[">"]||e["<"]?e:null,p=(a||{}).block||(a||{}).blacklist||(a||{}).ban||{},l=p.read&&("string"==typeof p.read||(p.read||{})["#"])?p.read:null,y="string"==typeof p?p:p.write&&("string"==typeof p.write||p.write["#"])?p.write:null;if(!u&&!f)return console.log("No policy found.");const h=JSON.stringify({c:t,...c?{e:c}:{},...u?{r:u}:{},...f?{w:f}:{},...l?{rb:l}:{},...y?{wb:y}:{}});var i=await r.sign(h,n,null,{raw:1});if(a.raw||(i="SEA"+JSON.stringify(i)),o)try{o(i)}catch(s){console.log(s)}return i}catch(s){if(r.err=s,r.throw)throw s;return void(o&&o())}}),t.exports=r.certify})(e,"./certify"),e(function(t){var r=e("./shim"),n=e("./root");n.work=e("./work"),n.sign=e("./sign"),n.verify=e("./verify"),n.encrypt=e("./encrypt"),n.decrypt=e("./decrypt"),n.certify=e("./certify"),n.random=n.random||r.random,n.Buffer=n.Buffer||e("./buffer"),n.keyid=n.keyid||(async t=>{try{const e=r.Buffer.concat(t.replace(/-/g,"+").replace(/_/g,"/").split(".").map(t=>r.Buffer.from(t,"base64"))),n=r.Buffer.concat([r.Buffer.from([153,e.length/256,e.length%256]),e]),o=await sha1hash(n),a=r.Buffer.from(o,"binary");return a.toString("hex",a.length-8)}catch(e){throw console.log(e),e}}),((n.window||{}).GUN||{}).SEA=n,t.exports=n})(e,"./sea"),e(function(t){var r,o=e("./sea");function a(t){this._={$:this}}function i(){return r.state().toString(36).replace(".","")}r=o.window?o.window.GUN||{chain:{}}:e((void 0+""==typeof n?".":"")+"./gun",1),o.GUN=r,a.prototype=function(){function t(){}return t.prototype=r.chain,new t}(),a.prototype.constructor=a,r.chain.user=function(t){var e,r=this.back(-1);if(t)return t=o.opt.pub((t._||"")["#"])||t,r.get("~"+t);if(e=r.back("user"))return e;var n=r=r._,s=n.opt.uuid||i;return(n=(e=n.user=this.chain(new a))._).opt={},n.opt.uuid=function(t){var e=s(),n=r.user;return n&&(n=n.is)&&(n=n.pub)?(e="~"+n+"/"+e,t&&t.call&&t(null,e),e):e},e},r.User=a,a.GUN=r,a.SEA=r.SEA=o,t.exports=a})(e,"./user"),e(function(t){var r;(""+r!=typeof GUN?GUN||{chain:{}}:e((""+r==typeof n?".":"")+"./gun",1)).chain.then=function(t,e){var r=this,n=new Promise(function(t,n){r.once(t,e)});return t?n.then(t):n}})(e,"./then"),e(function(t){var r=e("./user"),n=r.SEA,o=r.GUN,a=function(){};r.prototype.create=function(...t){var e,r="object"==typeof t[0]&&(t[0].pub||t[0].epub)?t[0]:"object"==typeof t[1]&&(t[1].pub||t[1].epub)?t[1]:null,i=r&&(r.pub||r.epub)?r.pub:"string"==typeof t[0]?t[0]:null,s=r&&(r.pub||r.epub)?r:i&&"string"==typeof t[1]?t[1]:null,c=t.filter(t=>"function"==typeof t)[0]||null,u=t&&t.length>1&&"object"==typeof t[t.length-1]?t[t.length-1]:{},f=this,p=f._,l=f.back(-1);if(c=c||a,!1!==(u=u||{}).check&&(i||(e="No user."),(s||"").length<8&&(e="Password too short!"),e))return c({err:o.log(e)}),f;if(p.ing)return(c||a)({err:o.log("User is already being created or authenticated!"),wait:!0}),f;p.ing=!0;var y={a:function(t){if(y.pubs=t,t&&!u.already){var e={err:o.log("User already created!")};return p.ing=!1,(c||a)(e),void f.leave()}y.salt=String.random(64),n.work(s,y.salt,y.b)},b:function(t){y.proof=t,r?y.c(r):n.pair(y.c)},c:function(t){var e;y.pair=t||{},(e=p.root.user)&&(e._.sea=t,e.is={pub:t.pub,epub:t.epub,alias:i}),y.data={pub:t.pub},y.d()},d:function(){y.data.alias=i,y.e()},e:function(){y.data.epub=y.pair.epub,n.encrypt({priv:y.pair.priv,epriv:y.pair.epriv},y.proof,y.f,{raw:1})},f:function(t){y.data.auth=JSON.stringify({ek:t,s:y.salt}),y.g(y.data.auth)},g:function(t){var e;y.data.auth=y.data.auth||t,l.get(e="~"+y.pair.pub).put(y.data).on(y.h);var r={};r[e]={"#":e},l.get("~@"+i).put(r).get(e).on(y.i)},h:function(t,e,r,n){n.off(),y.h.ok=1,y.i()},i:function(t,e,n,o){o&&(y.i.ok=1,o.off()),y.h.ok&&y.i.ok&&(p.ing=!1,c({ok:0,pub:y.pair.pub}),a===c&&(r?f.auth(r):f.auth(i,s)))}};return l.get("~@"+i).once(y.a),f},r.prototype.leave=function(t,e){var r=this.back(-1)._.user;if(r&&(delete r.is,delete r._.is,delete r._.sea),n.window)try{var o={};delete(o=n.window.sessionStorage).recall,delete o.pair}catch(a){}return this}})(e,"./create"),e(function(t){var r=e("./user"),n=r.SEA,o=r.GUN,a=function(){};function i(t){if("string"!=typeof t)return t;try{t=JSON.parse(t)}catch(e){t={}}return t}r.prototype.auth=function(...t){var e="object"==typeof t[0]&&(t[0].pub||t[0].epub)?t[0]:"object"==typeof t[1]&&(t[1].pub||t[1].epub)?t[1]:null,r=e||"string"!=typeof t[0]?null:t[0],s=!r&&(!e||e.priv&&e.epriv)||"string"!=typeof t[1]?null:t[1],c=t.filter(t=>"function"==typeof t)[0]||null,u=t&&t.length>1&&"object"==typeof t[t.length-1]?t[t.length-1]:{},f=this,p=f._,l=f.back(-1);if(p.ing)return(c||a)({err:o.log("User is already being created or authenticated!"),wait:!0}),f;p.ing=!0;var y,h={},g=9;return h.a=function(t){if(!t)return h.b();if(!t.pub){var e=[];return Object.keys(t).forEach(function(r){"_"!=r&&e.push(t[r])}),h.b(e)}if(h.name)return h.f(t);h.c((h.data=t).auth)},h.b=function(t){var e=(h.list=(h.list||[]).concat(t||[])).shift();if(y===e)return h.name?h.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer."):r&&g--?void l.get("~@"+r).once(h.a):h.err("Wrong user or password.");l.get(e).once(h.a)},h.c=function(t){return y===t?h.b():"string"==typeof t?h.c(i(t)):void n.work(s,(h.auth=t).s,h.d,h.enc)},h.d=function(t){n.decrypt(h.auth.ek,t,h.e,h.enc)},h.e=function(t){if(y===t)return h.enc?(h.enc=null,h.b()):(h.enc={encode:"utf8"},h.c(h.auth));h.half=t,h.f(h.data)},h.f=function(t){var e=h.half||{},r=h.data||{};h.g(h.lol={pub:t.pub||r.pub,epub:t.epub||r.epub,priv:t.priv||e.priv,epriv:t.epriv||e.epriv})},h.g=function(t){if(!t||!t.pub||!t.epub)return h.b();h.pair=t;var e=l._.user,g=e._;g.tag;var w=g.opt;(g=e._=l.get("~"+t.pub)._).opt=w,e.is={pub:t.pub,epub:t.epub,alias:r||t.pub},g.sea=h.pair,p.ing=!1;try{s&&y==(i(p.root.graph["~"+t.pub].auth)||"")[":"]&&(u.shuffle=u.change=s)}catch(b){}if(u.change?h.z():(c||a)(g),n.window&&(f.back("user")._.opt||u).remember)try{var d={};(d=n.window.sessionStorage).recall=!0,d.pair=JSON.stringify(t)}catch(b){}try{l._.tag.auth?l._.on("auth",g):setTimeout(function(){l._.on("auth",g)},1)}catch(b){o.log("Your 'auth' callback crashed with:",b)}},h.h=function(t){return t?((r=t.alias)||(r=t.alias="~"+e.pub),t.auth?(e=null,void h.c((h.data=t).auth)):h.g(e)):h.b()},h.z=function(){h.salt=String.random(64),n.work(u.change,h.salt,h.y)},h.y=function(t){n.encrypt({priv:h.pair.priv,epriv:h.pair.epriv},t,h.x,{raw:1})},h.x=function(t){h.w(JSON.stringify({ek:t,s:h.salt}))},h.w=function(t){if(u.shuffle){console.log("migrate core account from UTF8 & shuffle");var e={};Object.keys(h.data).forEach(function(t){e[t]=h.data[t]}),delete e._,e.auth=t,l.get("~"+h.pair.pub).put(e)}l.get("~"+h.pair.pub).get("auth").put(t,c||a)},h.err=function(t){var e={err:o.log(t||"User cannot be found!")};p.ing=!1,(c||a)(e)},h.plugin=function(t){if(!(h.name=t))return h.err();var e=[t];"~"!==t[0]&&(e[1]="~"+t,e[2]="~@"+t),h.b(e)},e?e.priv&&e.epriv?h.g(e):l.get("~"+e.pub).once(h.h):r?l.get("~@"+r).once(h.a):r||s||n.name(h.plugin),f}})(e,"./auth"),e(function(t){var r=e("./user"),n=r.SEA;r.GUN,r.prototype.recall=function(t,e){var r=this,o=r.back(-1);if((t=t||{})&&t.sessionStorage){if(n.window)try{var a;(a=n.window.sessionStorage)&&(o._.opt.remember=!0,(r.back("user")._.opt||t).remember=!0,(a.recall||a.pair)&&o.user().auth(JSON.parse(a.pair),e))}catch(i){}return r}return r}})(e,"./recall"),e(function(t){var r=e("./user"),n=r.SEA,o=r.GUN,a=function(){};r.prototype.pair=function(){var t,e=this;try{t=new Proxy({DANGER:"☠"},{get:function(t,r,n){if(e.is&&(e._||"").sea)return e._.sea[r]}})}catch(r){}return t},r.prototype.delete=async function(t,e,r){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!");var n=this;n.back(-1);var i=n.back("user");try{i.auth(t,e,function(t){(i.is||{}).pub,i.map().once(function(){this.put(null)}),i.leave(),(r||a)({ok:0})})}catch(s){o.log("User.delete failed! Error:",s)}return n},r.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");const t=this.back(-1);try{return await authRecall(t),t._.user._}catch(e){const t="No session!";throw o.log(t),{err:t}}},r.prototype.trust=async function(t){console.log("`.trust` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!"),o.is(t)&&t.get("pub").get((t,e)=>{console.log(t,e)}),t.get("trust").get(path).put(theirPubkey)},r.prototype.grant=function(t,e){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var r=this,o=r.back(-1).user(),a=o._.sea,i="";return r.back(function(t){t.is||(i+=t.get||"")}),async function(){var r,s=await o.get("grant").get(a.pub).get(i).then();(s=await n.decrypt(s,a))||(s=n.random(16).toString(),r=await n.encrypt(s,a),o.get("grant").get(a.pub).get(i).put(r));var c=t.get("pub").then(),u=t.get("epub").then();c=await c,u=await u;var f=await n.secret(u,a);r=await n.encrypt(s,f),o.get("grant").get(c).get(i).put(r,e)}(),r},r.prototype.secret=function(t,e){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var r=this,o=r.back(-1).user(),a=o.pair(),i="";return r.back(function(t){t.is||(i+=t.get||"")}),async function(){var s,c=await o.get("trust").get(a.pub).get(i).then();(c=await n.decrypt(c,a))||(c=n.random(16).toString(),s=await n.encrypt(c,a),o.get("trust").get(a.pub).get(i).put(s)),s=await n.encrypt(t,c),r.put(s,e)}(),r},t.exports=r})(e,"./share"),e(function(t){var r,o=e("./sea"),a=e("./settings"),i=(o.window||"").GUN||e((""+r==typeof n?".":"")+"./gun",1);function s(t){var e,r=this,n=r.as,a=t.put,c=a["#"],u=a["."],f=a[":"],p=a[">"],l=t["#"];if(c&&u)if((t._||"").faith&&(n.opt||"").faith&&"function"==typeof t._)o.opt.pack(a,function(e){o.verify(e,!1,function(e){a["="]=o.opt.unpack(e),r.to.next(t)})});else{var y=function(e){n.on("in",{"@":l,err:t.err=e})};(t._||"").DBG&&((t._||"").DBG.c=+new Date),0<=c.indexOf("<?")&&(e=parseFloat(c.split("<?")[1]||""))&&p<i.state()-1e3*e?(e=t._)&&e.stun&&e.stun--:"~@"!==c?"~@"!==c.slice(0,2)?(e=o.opt.pub(c))?s.pub(r,t,f,u,c,n,y,n.user||"",e):0<=c.indexOf("#")?s.hash(r,t,f,u,c,n,y):s.any(r,t,f,u,c,n,y,n.user||""):s.pubs(r,t,f,u,c,n,y):s.alias(r,t,f,u,c,n,y)}}i.on("opt",function(t){t.sea||(t.sea={own:{}},t.on("put",s,t)),this.to.next(t)}),s.hash=function(t,e,r,n,a,i,s){o.work(r,null,function(r){return r&&r===n.split("#").slice(-1)[0]||r&&r===function(t){let e="";for(let r=0;r<t.length;r++)e+=r-1&1?"":String.fromCharCode(parseInt(t.substring(r-1,r+1),16));return btoa(e)}(n.split("#").slice(-1)[0])?t.to.next(e):void s("Data hash not same as hash!")},{name:"SHA-256"})},s.alias=function(t,e,r,n,o,a,i){return r?"~@"+n===u(r)?t.to.next(e):void i("Alias not same!"):i("Data must exist!")},s.pubs=function(t,e,r,n,o,a,i){return r?n===u(r)?t.to.next(e):void i("Alias not same!"):i("Alias must exist!")},s.pub=async function(t,e,n,s,c,f,p,l,y){var h;const g=await a.parse(n)||{},w=(n,a,u)=>{if(n.m&&n.s&&a&&y)return o.verify(n,y,n=>{if(r!==n&&r!==n.e&&e.put[">"]&&e.put[">"]>parseFloat(n.e))return p("Certificate expired.");if(r!==n&&n.c&&n.w&&(n.c===a||n.c.indexOf("*")>-1)){let e=c.indexOf("/")>-1?c.replace(c.substring(0,c.indexOf("/")+1),""):"";String.match=String.match||i.text.match;const r=Array.isArray(n.w)?n.w:"object"==typeof n.w||"string"==typeof n.w?[n.w]:[];for(const i of r)if(String.match(e,i["#"])&&String.match(s,i["."])||!i["."]&&String.match(e,i["#"])||!i["#"]&&String.match(s,i["."])||String.match(e?e+"/"+s:s,i["#"]||i)){if(i["+"]&&i["+"].indexOf("*")>-1&&e&&-1==e.indexOf(a)&&-1==s.indexOf(a))return p(`Path "${e}" or key "${s}" must contain string "${a}".`);if(n.wb&&("string"==typeof n.wb||(n.wb||{})["#"])){var o=t.as.root.$.back(-1);return"string"==typeof n.wb&&"~"!==n.wb.slice(0,1)&&(o=o.get("~"+y)),o.get(n.wb).get(a).once(t=>!t||1!==t&&!0!==t?u(n):p(`Certificant ${a} blocked.`))}return u(n)}return p("Certificate verification fail.")}})};if("pub"===s&&"~"+y===c)return n===y?t.to.next(e):p("Account not same!");(h=l.is)&&h.pub&&!g["*"]&&!g["+"]&&(y===h.pub||y!==h.pub&&((e._.msg||{}).opt||{}).cert)?o.opt.pack(e.put,i=>{o.sign(i,l._.sea,async function(i){if(r===i)return p(o.err||"Signature fail.");if(e.put[":"]={":":h=o.opt.unpack(i.m),"~":i.s},e.put["="]=h,y===l.is.pub)return(h=u(n))&&((f.sea.own[h]=f.sea.own[h]||{})[y]=1),void JSON.stringifyAsync(e.put[":"],function(r,n){return r?p(r||"Stringify error."):(e.put[":"]=n,t.to.next(e))});if(y!==l.is.pub&&((e._.msg||{}).opt||{}).cert){const r=await a.parse(e._.msg.opt.cert);r&&r.m&&r.s&&w(r,l.is.pub,n=>{e.put[":"]["+"]=r,e.put[":"]["*"]=l.is.pub,JSON.stringifyAsync(e.put[":"],function(r,n){return r?p(r||"Stringify error."):(e.put[":"]=n,t.to.next(e))})})}},{raw:1})}):o.opt.pack(e.put,n=>{o.verify(n,g["*"]||y,function(n){var a;return n=o.opt.unpack(n),r===n?p("Unverified data."):((a=u(n))&&y===o.opt.pub(a)&&((f.sea.own[a]=f.sea.own[a]||{})[y]=1),g["+"]&&g["+"].m&&g["+"].s&&g["*"]?void w(g["+"],g["*"],r=>(e.put["="]=n,t.to.next(e))):(e.put["="]=n,t.to.next(e)))})})},s.any=function(t,e,r,n,o,a,i,s){if(a.opt.secure)return i("Soul missing public key at '"+n+"'.");a.on("secure",function(e){if(this.off(),!a.opt.secure)return t.to.next(e);i("Data cannot be changed.")}).on.on("secure",e)};var c=i.valid,u=function(t,e){return"string"==typeof(e=c(t))&&e};(i.state||"").ify;var f=/[^\w_-]/;o.opt.pub=function(t){if(t&&(t=t.split("~"))&&(t=t[1])&&(t=t.split(f).slice(0,2))&&2==t.length&&"@"!==(t[0]||"")[0])return t=t.slice(0,2).join(".")},o.opt.stringy=function(t){},o.opt.pack=function(t,e,n,a,s){var c,u;if(o.opt.check(t))return e(t);t&&t["#"]&&t["."]&&t[">"]&&(c=t[":"],u=1),JSON.parseAsync(u?c:t,function(o,c){var u=r!==(c||"")[":"]&&(c||"")["~"];e(u?{m:{"#":s||t["#"],".":n||t["."],":":(c||"")[":"],">":t[">"]||i.state.is(a,n)},s:u}:t)})};var p=o.opt;o.opt.unpack=function(t,e,n){var a;if(r!==t){if(t&&r!==(a=t[":"]))return a;if(e=e||p.fall_key,!n&&p.fall_val&&((n={})[e]=p.fall_val),e&&n){if(t===n[e])return t;if(!o.opt.check(n[e]))return t;var s=n&&n._&&n._["#"]||p.fall_soul,c=i.state.is(n,e)||p.fall_state;return t&&4===t.length&&s===t[0]&&e===t[1]&&l(c)===l(t[3])?t[2]:c<o.opt.shuffle_attack?t:void 0}}},o.opt.shuffle_attack=15463296e5;var l=Math.floor})(e,"./index")}()),a.exports);const c=n({__proto__:null,default:e(s)},[s]);export{c as s};
