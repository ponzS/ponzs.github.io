import{n as w,o as a,q as _,t as f,u as s,v as k,x as y,y as C,z as t,A as p,B as I,C as x,D as U,E as B,F as c,G as D}from"./index-SZnxMwDS.js";import{A as N}from"./config-DaGrT2J7.js";const V={class:"container mx-auto p-4"},A={key:0},E={key:0,class:"text-red-500 mt-4"},M={key:1,class:"text-center"},j=w({__name:"verify",setup(O){const r=a(""),i=a("type1"),n=a(""),d=a(!1),l=a(null);async function b(){try{const e=await(await fetch(`${N}/cards/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:r.value,type:i.value})})).json();e.success?(d.value=!0,l.value=e.card,localStorage.setItem("cardInfo",JSON.stringify({type:e.card.type,validUntil:e.card.validUntil}))):n.value=e.message}catch(o){console.error("Error verifying card:",o),n.value="验证失败，请重试"}}return _(()=>{const o=localStorage.getItem("cardInfo");if(o){const e=JSON.parse(o);new Date(e.validUntil)>new Date?(d.value=!0,l.value=e):localStorage.removeItem("cardInfo")}}),(o,e)=>{const g=f("ion-content"),S=f("ion-page");return s(),k(S,null,{default:y(()=>[C(g,null,{default:y(()=>{var v,m;return[t("div",V,[d.value?(s(),p("div",M,[e[7]||(e[7]=t("h2",{class:"text-2xl text-green-500"},"卡密验证成功！",-1)),t("p",null,"类型: "+c((v=l.value)==null?void 0:v.type),1),t("p",null,"有效期至: "+c((m=l.value)!=null&&m.validUntil?new Date(l.value.validUntil).toLocaleString():""),1)])):(s(),p("div",A,[e[6]||(e[6]=t("h1",{class:"text-2xl mb-4"},"验证卡密",-1)),t("form",{onSubmit:I(b,["prevent"]),class:"space-y-4"},[t("div",null,[e[3]||(e[3]=t("label",{class:"block mb-2"},"选择类型",-1)),x(t("select",{"onUpdate:modelValue":e[0]||(e[0]=u=>i.value=u),class:"w-full p-2 border rounded"},e[2]||(e[2]=[t("option",{value:"type1"},"类型1",-1),t("option",{value:"type2"},"类型2",-1),t("option",{value:"type3"},"类型3",-1)]),512),[[U,i.value]])]),t("div",null,[e[4]||(e[4]=t("label",{class:"block mb-2"},"输入卡密",-1)),x(t("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=u=>r.value=u),class:"w-full p-2 border rounded"},null,512),[[B,r.value]])]),e[5]||(e[5]=t("button",{type:"submit",class:"bg-blue-500 text-white px-4 py-2 rounded"}," 验证卡密 ",-1))],32),n.value?(s(),p("p",E,c(n.value),1)):D("",!0)]))])]}),_:1})]),_:1})}}});export{j as default};
