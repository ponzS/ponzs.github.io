const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-7zxB4USy.js","assets/utils-BrGt3VpK.js","assets/_commonjs-dynamic-modules-BHR_E30J.js","assets/sea-DOAW46wf.js"])))=>i.map(i=>d[i]);
import{u as e,b as a,_ as l}from"./index-DaoSW1E7.js";import{e as n,M as t,r as o,c as s,j as r,k as u,a as c,b as d,n as i,t as v,u as b,C as g,D as m,F as p,i as y,f as h,o as f}from"./vue-D4wD2Vkb.js";import"./utils-BrGt3VpK.js";import"./markdown-tTXJ_NsS.js";const x={class:"tic-tac-toe-game"},w={class:"mb-4"},k={class:"flex items-center gap-2 mb-2"},_={class:"text-xs font-bold"},I={class:"mb-2"},X={class:"text-xs font-bold block mb-1"},j={class:"flex gap-1"},E=["placeholder"],O=["disabled"],S={class:"mb-2"},T={class:"text-xs font-bold block mb-1"},C={class:"flex gap-1"},D=["placeholder","disabled"],P=["disabled"],F={class:"game-board mb-4"},A={class:"grid grid-cols-3 gap-1 w-48 h-48 mx-auto border-2 border-dashed border-border p-2"},V=["onClick"],G={class:"text-center"},K={class:"mb-2"},z={class:"text-sm font-bold"},J={key:0,class:"mb-2"},L={class:"text-center"},M={class:"text-xs text-gray-500 mt-1"},N={key:1,class:"mb-2"},R=["disabled"],U=l(n({__name:"TicTacToeGame",setup(l){const{t:n}=e(),U=t(Array(9).fill("")),W=o("X"),$=o("waiting"),q=o(null),B=o("X"),H=o("disconnected"),Q=o(120),Y=o(null),Z=s(()=>W.value===B.value),ee=o(""),ae=o(""),le=o(null),ne=o(null),te=o(null),oe=o(""),se=async()=>{if(ae.value&&le.value){H.value="connecting";try{const e=[ee.value,ae.value].sort();oe.value=`game_${e[0].slice(-8)}_${e[1].slice(-8)}`,B.value=ee.value<ae.value?"X":"O",te.value=ne.value.get(oe.value),te.value.on(e=>{if(e){const a=Z.value;if(e.board){const a=JSON.parse(e.board);for(let e=0;e<9;e++)U[e]=a[e]}e.currentPlayer&&(W.value=e.currentPlayer),e.gameStatus&&($.value=e.gameStatus),e.winner&&(q.value=e.winner),"playing"===$.value&&a!==Z.value&&ce(),"playing"!==$.value&&de()}}),H.value="connected",$.value="playing","X"===B.value&&(await re(),ce())}catch(e){console.error("Failed to connect:",e),H.value="disconnected"}}},re=async()=>{if(te.value)try{await te.value.put({board:JSON.stringify(U),currentPlayer:W.value,gameStatus:$.value,winner:q.value,timestamp:Date.now()})}catch(e){console.error("Failed to update game state:",e)}},ue=e=>"connected"===H.value&&"playing"===$.value&&""===U[e]&&W.value===B.value,ce=()=>{de(),Q.value=120,Y.value=setInterval(()=>{Q.value--,Q.value<=0&&ie()},1e3)},de=()=>{Y.value&&(clearInterval(Y.value),Y.value=null)},ie=async()=>{"playing"===$.value&&(de(),W.value="X"===W.value?"O":"X",await re(),ce())},ve=()=>{const e=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(const l of e){const[e,a,n]=l;if(U[e]&&U[e]===U[a]&&U[e]===U[n])return{isEnd:!0,isDraw:!1,winner:U[e]}}const a=U.every(e=>""!==e);return{isEnd:a,isDraw:a,winner:null}},be=async()=>{"connected"===H.value&&(de(),U.fill(""),W.value="X",$.value="playing",q.value=null,await re(),ce())};return r(()=>{(async()=>{try{const e=(await a(async()=>{const{default:e}=await import("./browser-7zxB4USy.js").then(e=>e.b);return{default:e}},__vite__mapDeps([0,1,2]))).default;await a(()=>import("./sea-DOAW46wf.js").then(e=>e.s),__vite__mapDeps([3,1,2])),ne.value=e(["https://a.talkflow.team/gun","https://gun.defucc.me/gun","https://gun-manhattan.herokuapp.com/gun","https://peer.wallie.io/gun","https://relay.peer.ooo/gun"]),le.value=await e.SEA.pair(),ee.value=le.value.pub,console.log("Gun initialized, public key:",ee.value)}catch(e){console.error("Failed to initialize Gun:",e)}})()}),u(()=>{de(),te.value&&te.value.off()}),(e,a)=>(f(),c("div",x,[d("div",w,[d("div",k,[d("div",{class:i(["w-3 h-3 rounded-full","connected"===H.value?"bg-green-500":"connecting"===H.value?"bg-yellow-500":"bg-red-500"])},null,2),d("span",_,v("connected"===H.value?b(n)("mesh.game.connection.connected"):"connecting"===H.value?b(n)("mesh.game.connection.connecting"):b(n)("mesh.game.connection.disconnected")),1)]),d("div",I,[d("label",X,v(b(n)("mesh.game.keys.yourKey"))+":",1),d("div",j,[g(d("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>ee.value=e),readonly:"",class:"flex-1 px-2 py-1 text-xs border border-dashed border-border bg-bg-secondary font-mono",placeholder:b(n)("mesh.game.keys.generating")},null,8,E),[[m,ee.value]]),d("button",{onClick:a[1]||(a[1]=e=>(async e=>{try{await navigator.clipboard.writeText(e),console.log("Copied to clipboard")}catch(a){console.error("Failed to copy:",a)}})(ee.value)),class:"px-2 py-1 text-xs border border-dashed border-border hover:bg-bg-secondary",disabled:!ee.value},v(b(n)("mesh.game.keys.copy")),9,O)])]),d("div",S,[d("label",T,v(b(n)("mesh.game.keys.opponentKey"))+":",1),d("div",C,[g(d("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>ae.value=e),class:"flex-1 px-2 py-1 text-xs border border-dashed border-border bg-bg-secondary font-mono",placeholder:b(n)("mesh.game.keys.enterOpponentKey"),disabled:"connected"===H.value},null,8,D),[[m,ae.value]]),d("button",{onClick:se,class:"px-2 py-1 text-xs border border-dashed border-border hover:bg-bg-secondary",disabled:!ae.value||"connected"===H.value},v(b(n)("mesh.game.controls.connect")),9,P)])])]),d("div",F,[d("div",A,[(f(!0),c(p,null,y(U,(e,a)=>(f(),c("div",{key:a,onClick:e=>(async e=>{if(!ue(e))return;de(),U[e]=B.value;const a=ve();a.isEnd?($.value=a.isDraw?"draw":"win",q.value=a.winner):W.value="X"===W.value?"O":"X",await re(),"playing"===$.value&&ce()})(a),class:i(["border border-dashed border-border flex items-center justify-center text-2xl font-bold cursor-pointer hover:bg-bg-secondary transition-colors",{"cursor-not-allowed opacity-50":!ue(a),"bg-bg-secondary":""!==e}])},v(e),11,V))),128))])]),d("div",G,[d("div",K,[d("span",z,v(b(n)("mesh.game.gameInfo.currentPlayer"))+": "+v(W.value===B.value?b(n)("mesh.game.gameInfo.you"):b(n)("mesh.game.gameInfo.opponent"))+" ("+v(W.value)+") ",1)]),"playing"===$.value?(f(),c("div",J,[d("div",L,[d("span",{class:i(["text-lg font-bold",{"text-red-600":Q.value<=30,"text-yellow-600":Q.value<=60&&Q.value>30,"text-green-600":Q.value>60}])},v(Math.floor(Q.value/60))+":"+v(String(Q.value%60).padStart(2,"0")),3),d("div",M,v(Z.value?b(n)("mesh.game.timer.yourTurn"):b(n)("mesh.game.timer.opponentTurn")),1)])])):h("",!0),"playing"!==$.value?(f(),c("div",N,[d("span",{class:i(["text-sm font-bold",{"text-green-600":"win"===$.value&&q.value===B.value,"text-red-600":"win"===$.value&&q.value!==B.value,"text-gray-600":"draw"===$.value}])},v("win"===$.value?q.value===B.value?b(n)("mesh.game.gameInfo.youWin"):b(n)("mesh.game.gameInfo.opponentWin"):b(n)("mesh.game.gameInfo.draw")),3)])):h("",!0),d("button",{onClick:be,class:"px-3 py-1 text-xs border border-dashed border-border hover:bg-bg-secondary",disabled:"connected"!==H.value},v(b(n)("mesh.game.controls.reset")),9,R)])]))}}),[["__scopeId","data-v-ea1af6eb"]]);export{U as default};
